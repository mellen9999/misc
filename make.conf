# Optimized compiler flags for Zen 4
CFLAGS="-march=znver4 -O3 -pipe -flto=thin -fomit-frame-pointer -fno-plt -fno-signed-zeros -mprefer-vector-width=512 -fno-trapping-math -fno-math-errno -fno-semantic-interposition"
CXXFLAGS="${CFLAGS}"

# Optimized linker flags with ThinLTO caching
LDFLAGS="-fuse-ld=lld -Wl,--as-needed,--thinlto-cache-dir=/var/tmp/thinlto-cache -Wl,-z,now,-z,relro,-z,pack-relative-relocs,-z,start-stop-gc"

# Rust optimizations
RUSTFLAGS="-C target-cpu=native -C opt-level=3 -C link-arg=-fuse-ld=lld"

# Parallel builds
MAKEOPTS="-j16"
EMERGE_DEFAULT_OPTS="--jobs=16 --load-average=14"

# Portage settings
FEATURES="clean-logs parallel-fetch strict"
PORT_LOGDIR="/var/log/portage"
PORTAGE_ELOG_CLASSES="info warn error log qa"
ACCEPT_KEYWORDS="~amd64"
ACCEPT_LICENSE="BSD MIT Apache-2.0 GPL-3+ LGPL-3+ MPL-2.0 Spotify ValveSteamLicense linux-fw-redistributable"

# Hardware-specific settings
VIDEO_CARDS="amdgpu radeonsi"
INPUT_DEVICES="libinput wooting"
ABI_X86="32 64"
CPU_FLAGS_X86="aes avx avx2 avx512_bf16 avx512_bitalg avx512_vbmi2 avx512_vnni avx512_vpopcntdq avx512bw avx512cd avx512dq avx512f avx512ifma avx512vbmi avx512vl bmi1 bmi2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3 vpclmulqdq"
LLVM_TARGETS="AMDGPU X86"

# USE flags for a modern desktop
USE="savedconfig dbus wayland pipewire alsa pulseaudio vaapi vulkan clang llvm dracut grub libplacebo opencl X libnotify zstd apng elogind opengl udev"
