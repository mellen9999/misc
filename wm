#!/bin/sh
set -e
# wayland environment
export XDG_SESSION_TYPE=wayland
export XDG_RUNTIME_DIR="/run/user/$(id -u)"
export XDG_CURRENT_DESKTOP=dwl
export QT_QPA_PLATFORM=wayland
export MOZ_ENABLE_WAYLAND=1
mkdir -p "$XDG_RUNTIME_DIR"
chmod 700 "$XDG_RUNTIME_DIR"

# audio pipeline
gentoo-pipewire-launcher start || {
    pipewire &
    pipewire-pulse &
    wireplumber &
}

# background services
/usr/libexec/dconf-service &
/usr/libexec/xdg-permission-store &

# start dwl
exec dbus-run-session dwl
